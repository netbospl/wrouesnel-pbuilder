#!/bin/bash
# Setup wrouesnel style pbuilder configuration for quick and easy automatic
# builds.


PBUILDER_REPO=$HOME/pbuilder-repo
PBUILDER_HOOKS=$HOME/.pbuilder-hooks

echo "Generating a key for use as signing..."
gpg --gen-key 

echo "Installing $1 as signing key for pbuilder-repo..."
gpg --export-secret-keys -a $1 | gpg --allow-secret-key-import --import --no-options --no-default-keyring --secret-keyring $PBUILDER_REPO/pbuilder-secret.gpg --keyring $PBUILDER_REPO/pbuilder-public.gpg --trustdb-name $PBUILDER_REPO/trustdb.gpg

echo "Installing $1 as trusted key in apt..."
gpg --export -a $1 | sudo apt-key add -

echo "Making pbuilder repository directory..."
mkdir -p $HOME/pbuilder-repo
cp -r pbuilder-repo/* $PBUILDER_REPO/

echo "Setting up pbuilder hooks..."
mkdir -p $PBUILDER_HOOKS
cp pbuilder-hooks/* $PBUILDER_HOOKS

echo "Installing .pbuilderrc..."
cp .pbuilderrc $HOME/.pbuilderrc


